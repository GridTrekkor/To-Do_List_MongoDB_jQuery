$(function(){function t(){return new Date}function e(t,e){return Math.floor(Math.random()*(e-t+1))+t}function i(){$(".note").length>=6?$("#addNote").hide():$("#addNote").show()}function n(t,e){e?$(".listItem").filter("[data-itemid="+t+"]").css({"text-decoration":"line-through"}):$(".listItem").filter("[data-itemid="+t+"]").css({"text-decoration":"none"})}function a(t,e){$.ajax({dataType:"json",method:"POST",contentType:"application/json",url:t,data:JSON.stringify(e),success:function(t){console.log(t)}})}function d(t,e,i,n,d){$("#mainContainer").append(v(t,e,i));var o=$(".note[data-notenumber="+t+"]");if(o.append("<h2><span class='noteTitle' data-titlenumber='"+t+"'>"+n+"</span></h2>"),o.append("<div class='addItem' data-notenumber='"+t+"'><img src='images/add.png' />Add Item</div>"),o.append("<div class='deleteNote' title='Delete Note'><img src='images/delete.png' /></div>"),o.append("<ul class='itemContainer' data-notenumber='"+t+"'></ul>"),s($("h2 > span[data-titlenumber="+t+"]"),"titleInput",e),I.splice($.inArray(i,I),1),d){var c={};c.NoteID=o.data("noteid"),c.Title=n,c.Color=o.css("background-color"),a("/notes/addNote",c)}}function o(t){for(;h<t.length;){for(p=t[h].NoteID,l=t[h].Title,m=t[h].Color,d(h,p,m,l,!1),u=0;u<t[h].Items.length;)c=t[h].Items[u].ItemID,l=t[h].Items[u].Title,r=t[h].Items[u].Checked,$("ul[data-notenumber="+h+"]").append("<li data-itemid='"+c+"' data-noteid='"+p+"'><img class='deleteItem' title='Delete Item' src='images/delete.png' data-noteid='"+p+"' data-itemid='"+c+"'/><img class='checkItem' src='images/check.png' data-itemid='"+c+"' data-noteid='"+p+"' /><span class='listItem' data-itemid='"+c+"'>"+l+"</span></li>"),s($("li[data-itemid="+c+"] > .listItem"),"itemInput",p,c),r&&n(c,r),u++;h++}i()}function s(t,e,i,n){var a=$("<input name='temp' type='text' class='"+e+"' />"),d=$("input[name='hiddenField']");t.inlineEdit(a,d,i,n)}var c,l,m,r,h=0,u=0,p=0,I=["rgb(255, 253, 199)","rgb(230, 253, 199)","rgb(255, 226, 199)","rgb(231, 217, 255)","rgb(199, 253, 255)","rgb(255, 226, 226)"];$.ajax({dataType:"json",method:"GET",url:"/notes/getNotes"}).done(function(t){o(t)}),$("#addNote").on("click",function(){h||(h=0),d(h,e(1e7,99999999),I[0],"Note",!0),h++,i()});var v=function(t,i,n){return n||(n=I[0]),"<div class='note' style='background-color:"+n+"' data-notenumber='"+t+"' data-noteid='"+(i?i:e(1e7,99999999))+"'></div>"};$(document).on("click",".addItem",function(){c=e(1e7,99999999),p=$(this).parent("div").data("noteid");var i=$(this).attr("data-notenumber");$("ul[data-notenumber="+i+"]").append("<li data-itemid='"+c+"' data-noteid='"+p+"'><img class='deleteItem' src='images/delete.png' data-noteid='"+p+"' data-itemid='"+c+"'/><img class='checkItem' title='Check Item' src='images/check.png' data-itemid='"+c+"' data-noteid='"+p+"' /><span class='listItem' data-itemid='"+c+"'>List item</span></li>"),s($("li[data-itemid="+c+"] > .listItem"),"itemInput",p,c);var n={};n.NoteID=$(this).parent("div").data("noteid"),n.ItemID=c,n.Title="List item",n.DateCreated=t(),n.Checked=!1,a("/notes/addItem",n)});var f=($(document).on("click",".deleteNote",function(){$(this).parent("div").remove();var t={};t.NoteID=$(this).parent("div").data("noteid"),a("/notes/deleteNote",t),I.push($(this).parent("div").css("background-color")),i()}),!1);$(document).on("click",".checkItem",function(){f?($(this).closest("li").find("span").css("text-decoration","none"),$(this).removeClass("checkItemSelected"),f=!1):($(this).closest("li").find("span").css({"text-decoration":"line-through"}),$(this).addClass("checkItemSelected"),f=!0);var t={};t.NoteID=$(this).data("noteid"),t.ItemID=$(this).data("itemid"),t.Checked=f,a("/notes/checkItem",t)}),$(document).on("click",".deleteItem",function(){$(this).closest("li").remove();var t={};t.NoteID=$(this).data("noteid"),t.ItemID=$(this).data("itemid"),a("/notes/deleteItem",t)}),$.fn.inlineEdit=function(t,e,i,n){$(this).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),$(this).on("click",function(){function d(t,e,i,n){var d;d="noteTitle"==t?"/notes/editNoteTitle":"/notes/editItemTitle";var o={};o.NoteID=i,n&&(o.ItemID=n),o.Title=e,a(d,o)}var o=$(this);o.hide(),o.after(t),t.focus(),t.select(),t.blur(function(){""!=$(this).val()&&(e.val($(this).val()).change(),o.text($(this).val())),$(this).remove(),o.show(),d(o[0].className,o[0].innerText,i,n)}),$(document).keydown(function(e){13==e.which&&t.blur()})})}});